import schedule
from datetime import datetime, timedelta, date
import datetime
import calendar
import time

myclint = MongoClint("")
db = myclint["---"]
allocation_db = db['Allocations']

def findDay(date):
    Monday={"2150496837":[0,0,0,0,0,0],"5092178463":[0,0],"3658924710":[0,0,0,0,0,0],"8475092163":[0,0,0,0],"4210935678":[0,0,0,0],
            "2468013579":[0,0,0,0,0,0],"3826497015":[0,0,0,0,0,0,0,0,0,0],"2196837450":[0,0,0,0,0,0,0,0],
            "7902163458":[0,0,0,0,0,0], "4567890123":[0,0,0,0,0,0,0,0],"2784051963":[0,0,0,0,0,0],
            "7045821963":[0,0,0,0,0,0,0,0],"8041967325":[0,0,0,0],
            "3178452096":[0,0,0,0,0,0],"5092173468":[0,0,0,0,0,0],
            "6957201834":[0,0,0,0,0,0,0,0],"8240967315":[0,0,0,0,0,0,0,0,0,0],"5723019846":[0,0,0,0,0,0,0,0],
            "7463018259":[0,0,0,0,0,0], "9325671840":[0,0,0,0,0,0],"3618275940":[0,0,0,0,0,0,0,0],
            "8142059376":[0,0,0,0,0,0,0,0,0,0],"8201734659":[0,0,0,0,0,0,0,0],"6328491705":[0,0,0,0,0,0,0,0],
            "9726103845":[0,0,0,0,0,0],"3605928147":[0,0,0,0,0,0],"9163847250":[0,0,0,0,0,0,0,0,0,0],
            "4759302168":[0,0,0,0,0,0,0,0], "7325698041":[0,0,0,0,0,0,0,0], "8146903275":[0,0,0,0,0,0,0,0,0,0],
            "7314825609":[0,0,0,0,0,0], "3627840159":[0,0,0,0,0,0], "1409256387":[0,0,0,0,0,0,0,0,0,0], "4052867139":[0,0,0,0,0,0,0,0,0,0],
            "7240938561":[0,0,0,0,0,0,0,0,0,0], "5361928470":[0,0,0,0,0,0,0,0], "6205831749":[0,0,0,0,0,0,0,0,0,0],"8496312057":[0,0,0,0,0,0],
            "3968502147":[0,0,0,0,0,0], "5276938401":[0,0,0,0,0,0,0,0,0,0], "6704952138":[0,0,0,0,0,0,0,0,0,0,0,0],
            "8293614750":[0,0,0,0,0,0,0,0,0,0,0,0], "7206958431":[0,0,0,0,0,0,0,0,0,0,0,0], "3704815926":[0,0,0,0,0,0,0,0,0,0,0,0],
            "7612083459":[0,0,0,0,0,0,0,0,0,0,0,0], "5947382016":[0,0,0,0,0,0,0,0,0,0,0,0], "8901627543":[0,0,0,0,0,0,0,0,0,0,0,0],
            "4169257380":[0,0,0,0,0,0,0,0,0,0,0,0], "3406928175":[0,0,0,0,0,0,0,0,0,0,0,0], "1432765980":[0,0,0,0,0,0,0,0,0,0,0,0],
            "5402768139":[0,0,0,0,0,0,0,0,0,0,0,0]   
            }
    born = datetime.datetime.strptime(date, '%d %m %Y').weekday()
    return (calendar.day_name[born])

def refine_day_list():
    today = date.today()

    remove_date = today - timedelta(days=1)
    #print(remove_date)

    add_date = today + timedelta(days=13)
    #print(add_date)

    add_date_sting=str(add_date)
    add_date_sting=add_date_sting.split('-')
    new_string=add_date_sting[::-1]
    add_day=" ".join(new_string)

    day=findDay(add_day)

    delete_query = {'Date':remove_date}
    allocation_db.delete_one(delete_query)

    record = {'Date':add_date,'Times':day}
    allocation_db.insert_one(record)


while True:
    schedule.every().day.at("00:10").do(refine_day_list)
    time.sleep(1)
